<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basilisk C2 | SOC Operations</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <link rel="stylesheet" href="/static/css/dashboard.css">
    
    <script>
        console.log("[BASILISK] ========== DASHBOARD LOADING ==========");
        console.log("[BASILISK] Time: " + new Date().toLocaleTimeString());
        console.log("[BASILISK] URL: " + window.location.href);
        
        window.basiliskLogs = ["[BASILISK] Page started loading"];
        
        const originalConsoleLog = console.log;
        console.log = function() {
            originalConsoleLog.apply(console, arguments);
            const msg = Array.from(arguments).join(" ");
            if (msg.includes("[BASILISK]") || msg.includes("[")) {
                window.basiliskLogs.push(msg);
            }
        };
    </script>
    
    <script src="/static/js/dashboard.js"></script>
</head>
<body>

    <div id="sidebar">
        <div class="brand-logo">
            <div class="d-flex justify-content-between align-items-center">
                <span class="brand-title d-flex align-items-center">
                    <img src="/static/img/logo.ico" alt="Basilisk Logo" class="logo" width="50">  
                </span>
                <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 font-monospace">BASILISK v7.1</span>
            </div>
            <div class="text-muted opacity-50 small mt-2 fw-bold" style="font-size: 0.6rem; letter-spacing: 2px;">THREAT OPERATIONS CENTER</div>
        </div>

        <div class="mt-4 d-flex flex-column gap-1">
            <div class="nav-link-custom active" onclick="switchView('dashboard')">
                <i class="fa-solid fa-grip me-3 text-center" style="width:20px"></i>Dashboard
            </div>
            <div class="nav-link-custom" onclick="switchView('network')">
                <i class="fa-solid fa-globe me-3 text-center" style="width:20px"></i>Global Map
            </div>
            <div class="nav-link-custom" onclick="Swal.fire('Compliance', 'Select an agent to view logs.', 'info')">
                <i class="fa-solid fa-file-shield me-3 text-center" style="width:20px"></i>Compliance
            </div>
        </div>

        <div class="mt-auto p-4 border-top border-secondary border-opacity-25 bg-black bg-opacity-25 position-absolute bottom-0 w-100">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <span class="small text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Uplink Status</span>
                <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 shadow-sm font-monospace" id="server-status-badge">OFFLINE</span>
            </div>
            <button class="btn btn-outline-danger btn-sm w-100 font-monospace" onclick="logout()">
                <i class="fa-solid fa-power-off me-2"></i>TERMINATE SESSION
            </button>
        </div>
    </div>

    <div id="main-content">
        
        <div id="view-dashboard" class="dashboard-section">
            
            <div class="row g-4 mb-5">
                <div class="col-md-3">
                    <div class="p-4 kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div><div class="kpi-title">Active Assets</div><div class="kpi-value text-neon mt-2" id="kpi-agents">0</div></div>
                            <div class="text-success opacity-25"><i class="fa-brands fa-windows fa-2x"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="p-4 kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div><div class="kpi-title">Critical Threats</div><div class="kpi-value text-danger mt-2" id="kpi-critical">0</div></div>
                            <div class="text-danger opacity-25"><i class="fa-solid fa-biohazard fa-2x"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="p-4 kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div><div class="kpi-title">System Integrity</div><div class="kpi-value text-info mt-2" id="kpi-fim">100%</div></div>
                            <div class="text-info opacity-25"><i class="fa-solid fa-shield-halved fa-2x"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-grid">
                    <button class="btn btn-outline-secondary h-100 d-flex flex-column align-items-center justify-content-center" 
                            onclick="toggleCharts()" 
                            style="border: 1px dashed rgba(255,255,255,0.2); background: rgba(255,255,255,0.02);">
                        <i class="fa-solid fa-chart-pie mb-2 fa-lg"></i>
                        <span class="small text-uppercase fw-bold">Toggle Metrics</span>
                    </button>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-3">
                    <h6 class="text-muted text-uppercase mb-3 small fw-bold font-monospace"><i class="fa-solid fa-network-wired me-2"></i>Connected Nodes</h6>
                    <div id="agents-list" class="agent-list-container"></div>
                </div>

                <div class="col-md-9">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="text-muted text-uppercase small fw-bold mb-0 font-monospace">
                            <i class="fa-solid fa-satellite-dish me-2"></i>Live Incident Feed
                        </h6>
                        <div class="d-flex gap-2">
                            <select id="incident-limit" class="form-select form-select-sm bg-dark text-light border-secondary" 
                                    style="width: auto; font-size: 0.7rem;" onchange="fetchDashboardData()">
                                <option value="5">SHOW 5</option>
                                <option value="10" selected>SHOW 10</option>
                                <option value="20">SHOW 20</option>
                                <option value="50">SHOW 50</option>
                            </select>
                            
                            <button class="btn btn-outline-secondary btn-sm border-0" onclick="fetchDashboardData()" title="Refresh Data">
                                <i class="fa-solid fa-rotate-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="bg-panel rounded p-3">
                        <table id="incidents-table" class="table w-100 mb-0">
                            <thead><tr><th>Time</th><th>Source ID</th><th>Severity</th><th>Threat Type</th><th>Payload / Details</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row g-4 mt-2" id="chart-area" style="display:none;">
                 <div class="col-md-12"><hr class="border-secondary opacity-25"></div>
                <div class="col-md-4">
                    <div class="p-3 bg-panel rounded">
                        <h6 class="text-muted small mb-3 font-monospace text-uppercase text-center">Threat Severity</h6>
                        <div style="height:250px;"><canvas id="chartSeverity"></canvas></div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="p-3 bg-panel rounded">
                        <h6 class="text-muted small mb-3 font-monospace text-uppercase text-center">Attack Vectors</h6>
                        <div style="height:250px;"><canvas id="chartTypes"></canvas></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-network" class="dashboard-section" style="display:none; height: 85vh; position: relative;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="font-monospace text-white"><i class="fa-solid fa-earth-americas text-primary me-2"></i>GLOBAL TOPOLOGY</h4>
                <button class="btn btn-outline-secondary btn-sm font-monospace" onclick="switchView('dashboard')">EXIT MAP VIEW</button>
            </div>
            <div id="mynetwork" style="width: 100%; height: 100%; border-radius: 8px;"></div>
            
            <div class="position-absolute bottom-0 start-0 m-4 p-3 bg-black bg-opacity-75 rounded border border-secondary border-opacity-25" style="max-width: 250px; backdrop-filter: blur(5px);">
                <small class="text-muted d-block mb-2 font-monospace fw-bold text-uppercase" style="font-size: 0.7rem;">Map Legend</small>
                <div class="d-flex align-items-center mb-1 small text-light"><span style="width:8px;height:8px;background:#10b981;border-radius:50%;margin-right:10px;box-shadow:0 0 5px #10b981;"></span> Active Host</div>
                <div class="d-flex align-items-center mb-1 small text-light"><span style="width:8px;height:8px;background:#ef4444;border-radius:50%;margin-right:10px;box-shadow:0 0 5px #ef4444;"></span> External Threat</div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="reportModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content text-light">
                <div class="modal-header pt-3 pb-3">
                    <h5 class="modal-title font-monospace" id="modalTitle"></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-header pt-0 pb-0 border-0 bg-black bg-opacity-25">
                    <ul class="nav nav-tabs border-0" id="reportTabs">
                        <li class="nav-item"><button class="nav-link active rounded-0" data-bs-toggle="tab" data-bs-target="#processes-tab" onclick="loadReportView('processes')">PROCESSES</button></li>
                        <li class="nav-item"><button class="nav-link rounded-0" data-bs-toggle="tab" data-bs-target="#ports-tab" onclick="loadReportView('ports')">NET PORTS</button></li>
                        <li class="nav-item"><button class="nav-link rounded-0" data-bs-toggle="tab" data-bs-target="#audit-tab" onclick="loadReportView('audit')">AUDIT LOGS</button></li>
                        <li class="nav-item"><button class="nav-link rounded-0 text-danger" data-bs-toggle="tab" data-bs-target="#actions-tab">RESPONSE</button></li>
                    </ul>
                </div>
                <div class="modal-body p-0 bg-transparent">
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="processes-tab"><div id="processes-content" class="table-responsive p-3"></div></div>
                        <div class="tab-pane fade" id="ports-tab"><div id="ports-content" class="table-responsive p-3"></div></div>
                        <div class="tab-pane fade" id="audit-tab"><div id="audit-content" class="p-4"></div></div>
                        <div class="tab-pane fade" id="actions-tab">
                            <div class="p-5 d-flex flex-column gap-3 align-items-center justify-content-center text-center">
                                <h5 class="text-danger font-monospace mb-4"><i class="fa-solid fa-triangle-exclamation me-2"></i>ACTIVE COUNTERMEASURES</h5>
                                <div class="d-flex gap-4">
                                    <button class="btn btn-outline-danger btn-lg p-4 border-opacity-50" onclick="confirmIsolation(true)">
                                        <div class="mb-2"><i class="fa-solid fa-ban fa-2x"></i></div><div class="small fw-bold">ISOLATE HOST</div>
                                    </button>
                                    <button class="btn btn-outline-success btn-lg p-4 border-opacity-50" onclick="confirmIsolation(false)">
                                        <div class="mb-2"><i class="fa-solid fa-link fa-2x"></i></div><div class="small fw-bold">RESTORE ACCESS</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>