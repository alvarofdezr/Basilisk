<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PySentinel C2 | SOC Dashboard v6.1.1</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

    <style>
        :root {
            --bg-body: #0f172a;       /* Fondo */
            --bg-panel: #1e293b;      /* Paneles/Cards */
            --bg-card: #334155;       /* Componentes internos */
            --accent-primary: #3b82f6; /* Azul Corporativo */
            --sidebar-width: 260px;
        }
        body {
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: 'Segoe UI', sans-serif;
            overflow-x: hidden;
            padding-left: var(--sidebar-width);
        }
        /* --- SIDEBAR --- */
        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0; top: 0;
            background: var(--bg-panel);
            border-right: 1px solid var(--bg-card);
            z-index: 1000;
        }
        .brand-logo { padding: 24px; font-size: 1.25rem; font-weight: 700; color: white; border-bottom: 1px solid var(--bg-card); }
        .nav-link-custom { padding: 14px 24px; color: #94a3b8; cursor: pointer; transition: 0.2s; border-left: 3px solid transparent; }
        .nav-link-custom:hover, .nav-link-custom.active { background: rgba(59, 130, 246, 0.08); color: white; border-left-color: var(--accent-primary); }

        /* --- CONTENIDO PRINCIPAL --- */
        #main-content { padding: 30px; }

        /* --- KPI CARDS --- */
        .kpi-card {
            background: var(--bg-panel);
            border-left: 5px solid var(--accent-primary);
            border-radius: 6px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .kpi-value { font-size: 2rem; font-weight: 700; }
        .kpi-title { font-size: 0.85rem; color: #94a3b8; }

        /* --- AGENT CARDS (SOC View) --- */
        .agent-list-container { max-height: calc(100vh - 200px); overflow-y: auto; padding-right: 5px; }
        .agent-card {
            background: var(--bg-card);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid #22c55e; /* Default Online */
        }
        .agent-card.warning { border-left-color: #f59e0b; }
        .agent-card.critical { border-left-color: #ef4444; }

        /* --- LOGS (DATATABLES) --- */
        #incidents-table_wrapper { padding: 20px; background: var(--bg-panel); border-radius: 6px; }
        .dataTables_filter label, .dataTables_length label { color: #94a3b8; }
        table.dataTable thead th, table.dataTable tbody td { border-color: #334155 !important; }
        table.dataTable.dtr-column.collapsed>tbody>tr>td:first-child:before { background: var(--accent-primary) !important; }
        .dataTables_info, .dataTables_paginate { color: #94a3b8; }
        .dataTables_wrapper .dataTables_paginate .paginate_button.current { background: var(--accent-primary) !important; border-color: var(--accent-primary) !important; color: white !important; }

        /* --- GRÁFICOS OCULTOS --- */
        #chart-area { display: none; margin-top: 30px; } /* INICIALMENTE OCULTO */

        /* --- MODAL Tabs Fix --- */
        .nav-tabs .nav-link { color: #94a3b8 !important; border: none; }
        .nav-tabs .nav-link.active { background-color: var(--bg-panel) !important; color: white !important; border-bottom: 2px solid var(--accent-primary); }
    </style>
</head>
<body>

    <div id="sidebar">
        <div class="brand-logo">
            <i class="fa-solid fa-shield-halved me-2 text-info"></i>PySentinel C2
        </div>
        <div class="mt-3">
            <div class="nav-link-custom active"><i class="fa-solid fa-gauge-high me-2"></i>Dashboard</div>
            <div class="nav-link-custom"><i class="fa-solid fa-sitemap me-2"></i>Topología (Vis.js)</div>
            <div class="nav-link-custom" onclick="openReports()"><i class="fa-solid fa-file-pdf me-2"></i>Generar Reporte</div>
        </div>
        <div class="mt-auto p-4 border-top border-secondary">
            <div class="d-flex align-items-center justify-content-between">
                <span class="small text-muted">C2 Server</span>
                <span class="badge bg-danger" id="server-status-badge">OFFLINE</span>
            </div>
             <div class="nav-link-custom text-danger mt-3" onclick="logout()"><i class="fa-solid fa-right-from-bracket me-3"></i>Logout</div>
        </div>
    </div>

    <div id="main-content">
        
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="p-3 kpi-card">
                    <div class="kpi-title"><i class="fa-solid fa-wifi me-1"></i>Agentes Online</div>
                    <div class="kpi-value text-success" id="kpi-agents">0</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 kpi-card">
                    <div class="kpi-title"><i class="fa-solid fa-skull me-1"></i>Incidentes Críticos (24h)</div>
                    <div class="kpi-value text-danger" id="kpi-critical">0</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 kpi-card">
                    <div class="kpi-title"><i class="fa-solid fa-floppy-disk me-1"></i>Archivos en Baseline</div>
                    <div class="kpi-value text-info" id="kpi-fim">?</div>
                </div>
            </div>
             <div class="col-md-3 d-grid">
                <button class="btn btn-warning mt-auto" id="toggle-charts-btn" onclick="toggleCharts()">
                    <i class="fa-solid fa-chart-pie me-2"></i>Ver Gráficos Detallados
                </button>
            </div>
        </div>
        
        <div class="row g-4">
            
            <div class="col-md-4">
                <h5 class="text-white mb-3"><i class="fa-solid fa-desktop me-2"></i>Agentes Activos</h5>
                <div id="agents-list" class="agent-list-container">
                    <p class="text-muted text-center mt-5">Esperando heartbeats...</p>
                </div>
            </div>

            <div class="col-md-8">
                <h5 class="text-white mb-3"><i class="fa-solid fa-fire-extinguisher me-2"></i>Live Incident Feed</h5>
                <div class="card-custom p-0" style="background:var(--bg-panel);">
                    <table id="incidents-table" class="table table-dark table-striped table-hover" style="width:100%">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Severidad</th>
                                <th>Tipo</th>
                                <th>Mensaje</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row g-4" id="chart-area">
             <hr class="text-secondary mt-5">
             <div class="col-md-12">
                 <h5 class="text-white mb-3"><i class="fa-solid fa-magnifying-glass-chart me-2"></i>Análisis de Tendencias</h5>
             </div>
            <div class="col-md-4">
                <div class="card-custom p-3" style="background:var(--bg-panel);">
                    <h6 class="text-muted">Distribución de Severidad</h6>
                    <div style="height:250px;"><canvas id="chartSeverity"></canvas></div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card-custom p-3" style="background:var(--bg-panel);">
                    <h6 class="text-muted">Top 5 Tipos de Incidentes</h6>
                    <div style="height:250px;"><canvas id="chartTypes"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="reportModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content bg-dark border-secondary text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title text-white" id="modalTitle">Agent Inspector: <span id="agent-host-name"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-header pt-0 pb-0 border-secondary">
                    <ul class="nav nav-tabs" id="reportTabs" role="tablist">
                        <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#processes-tab-pane" type="button" role="tab" onclick="loadReportView('processes')"><i class="fa-solid fa-list-check me-1"></i>Procesos</button></li>
                        <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#ports-tab-pane" type="button" role="tab" onclick="loadReportView('ports')"><i class="fa-solid fa-network-wired me-1"></i>Puertos</button></li>
                        <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#shell-tab-pane" type="button" role="tab" onclick="loadReportView('shell')"><i class="fa-solid fa-terminal me-1"></i>Live Shell (WIP)</button></li>
                    </ul>
                </div>
                
                <div class="modal-body p-0">
                    <div class="tab-content" id="reportTabsContent">
                        <div class="tab-pane fade show active" id="processes-tab-pane" role="tabpanel" tabindex="0">
                            <div id="processes-loader" class="text-center py-5 d-none"><div class="spinner-border text-primary"></div></div>
                            <div id="processes-content" class="table-responsive"></div>
                        </div>
                        <div class="tab-pane fade" id="ports-tab-pane" role="tabpanel" tabindex="0">
                            <div id="ports-loader" class="text-center py-5 d-none"><div class="spinner-border text-primary"></div></div>
                            <div id="ports-content" class="table-responsive"></div>
                        </div>
                        <div class="tab-pane fade" id="shell-tab-pane" role="tabpanel" tabindex="0">
                            <div class="p-4">
                                <h6 class="text-warning"><i class="fa-solid fa-hammer me-1"></i>Live Shell Command (Work In Progress)</h6>
                                <p class="small text-muted">Esta vista permitirá enviar comandos de sistema (como `ps`, `netstat`, `whoami`) directamente al agente. ¡Llegará pronto!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer border-secondary bg-black">
                    <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-primary btn-sm" onclick="refreshCurrentView()">Refresh Current Data</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    
    <script>
        // --- CONFIGURACIÓN GLOBAL ---
        const API_BASE = "https://localhost:8443/api/v1";
        const REFRESH_RATE = 3000; // 3 seconds

        // --- ESTADO Y CACHE ---
        let agentsCache = {};
        let dataTable = null;
        let chartSeverity, chartTypes;
        let selectedAgentID = null;
        let currentReportType = 'processes'; // Controla qué pestaña está activa
        const modalInstance = new bootstrap.Modal(document.getElementById('reportModal'));

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            initDataTables();
            initCharts();
            startPolling();
        });

        function startPolling() {
            fetchDashboardData();
            setInterval(fetchDashboardData, REFRESH_RATE);
        }
        
        // --- FUNCIONES DE GRÁFICOS ---
        function initCharts() {
            // Doughnut Chart (Severity)
            const ctxSev = document.getElementById('chartSeverity').getContext('2d');
            chartSeverity = new Chart(ctxSev, {
                type: 'doughnut',
                data: {
                    labels: ['CRITICAL', 'WARNING', 'INFO'],
                    datasets: [{
                        data: [0, 0, 1],
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#94a3b8' } } }, cutout: '70%' }
            });
            
            // Bar Chart (Top 5 Types)
            const ctxTypes = document.getElementById('chartTypes').getContext('2d');
             chartTypes = new Chart(ctxTypes, {
                type: 'bar',
                data: {
                    labels: [], // Injected via API
                    datasets: [{
                        label: 'Event Count',
                        data: [],
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, indexAxis: 'y', 
                    scales: {
                        x: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
                        y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function toggleCharts() {
            const chartArea = document.getElementById('chart-area');
            const button = document.getElementById('toggle-charts-btn');
            
            if (chartArea.style.display === 'none') {
                chartArea.style.display = 'flex';
                button.innerHTML = '<i class="fa-solid fa-chart-pie me-2"></i>Ocultar Gráficos';
                chartSeverity.update();
                chartTypes.update(); 
            } else {
                chartArea.style.display = 'none';
                button.innerHTML = '<i class="fa-solid fa-chart-pie me-2"></i>Ver Gráficos Detallados';
            }
        }

        // --- DATATABLES ---
        function initDataTables() {
            dataTable = new $('#incidents-table').DataTable({
                dom: 'lfrtip', 
                responsive: true,
                order: [[0, 'desc']], 
                pagingType: 'full_numbers',
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json'
                },
                columns: [
                    { data: 'received_at' },
                    { data: 'severity', className: 'dt-body-center' },
                    { data: 'type' },
                    { data: 'message' }
                ],
                columnDefs: [
                    { 
                        targets: [1], 
                        render: function(data, type, row) {
                            if (type === 'display') {
                                const map = { 'CRITICAL': 'danger', 'WARNING': 'warning', 'INFO': 'success', 'RANSOMWARE': 'danger' };
                                return `<span class="badge bg-${map[data] || 'secondary'}">${data}</span>`;
                            }
                            return data;
                        }
                    },
                     { 
                        targets: [0], 
                        render: function(data, type, row) {
                            if (type === 'display') {
                                return new Date(data).toLocaleTimeString();
                            }
                            return data;
                        }
                    }
                ],
                data: []
            });
        }

        // --- API & DATA FETCHING ---
        async function fetchDashboardData() {
            try {
                const res = await fetch(`${API_BASE}/dashboard`);
                const data = await res.json();
                
                updateServerStatus(true);
                renderKPIs(data);
                renderAgentList(data.agents);
                updateDataTables(data.recent_incidents);
                updateCharts(data.recent_incidents);
            } catch(e) {
                updateServerStatus(false);
            }
        }
        
        // --- RENDERIZADO DE DATOS ---
        
        function updateServerStatus(isOnline) {
            const badge = document.getElementById('server-status-badge');
            if (isOnline) {
                badge.className = "badge bg-success";
                badge.innerText = "ONLINE";
            } else {
                badge.className = "badge bg-danger";
                badge.innerText = "OFFLINE";
            }
        }

        function renderKPIs(data) {
            const onlineCount = Object.keys(data.agents).length;
            const criticalCount = data.recent_incidents.filter(i => i.severity === 'CRITICAL').length;
            
            document.getElementById('kpi-agents').innerText = onlineCount;
            document.getElementById('kpi-critical').innerText = criticalCount;
            document.getElementById('kpi-fim').innerText = '?'; // Placeholder
        }

        function renderAgentList(agents) {
            const list = document.getElementById('agents-list');
            if(Object.keys(agents).length === 0) {
                 list.innerHTML = `<p class="text-muted text-center mt-5">Esperando heartbeats...</p>`;
                 return;
            }
            
            list.innerHTML = "";
            for(const [id, info] of Object.entries(agents)) {
                const lastSeen = new Date(info.last_seen);
                const isActive = (new Date() - lastSeen) < (REFRESH_RATE + 1000);
                
                const cpu = Math.round(info.cpu_percent || 0);
                const ram = Math.round(info.ram_percent || 0);
                
                // Determinamos el color de la tarjeta según la carga
                let agentCardClass = isActive ? 'online' : 'warning';
                if (cpu > 85 || ram > 90) {
                     agentCardClass = 'critical';
                } else if (cpu > 60 || ram > 75) {
                     agentCardClass = 'warning';
                }

                list.innerHTML += `
                <div class="agent-card ${agentCardClass}">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong class="text-white">${info.hostname}</strong>
                        <span class="badge bg-${isActive ? 'success' : 'warning'}" style="font-size:0.7rem">${isActive ? 'Active' : 'Stale'}</span>
                    </div>
                    <div class="text-muted small mb-3">${id}</div>
                    
                    <div class="small">
                        <span class="text-muted">CPU (${cpu}%):</span> 
                        <div class="progress mb-1" style="height: 5px;"><div class="progress-bar bg-info" style="width: ${cpu}%"></div></div>
                        <span class="text-muted">RAM (${ram}%):</span> 
                        <div class="progress mb-3" style="height: 5px;"><div class="progress-bar bg-warning" style="width: ${ram}%"></div></div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                         <button class="btn btn-sm btn-outline-secondary py-0" onclick="openReport('${id}', '${info.hostname}')">Inspect</button>
                         <button class="btn btn-sm btn-danger py-0" onclick="triggerCommand('${id}', 'KILL:ALL')">Panic Kill</button>
                    </div>
                </div>`;
            }
        }
        
        function updateDataTables(logs) {
            dataTable.clear().rows.add(logs).draw();
        }
        
        function updateCharts(logs) {
            if (!logs || logs.length === 0) return;
            
            let severityCounts = { 'CRITICAL': 0, 'WARNING': 0, 'INFO': 0 };
            let typeCounts = {};

            logs.forEach(l => {
                if (severityCounts.hasOwnProperty(l.severity)) {
                    severityCounts[l.severity]++;
                }
                typeCounts[l.type] = (typeCounts[l.type] || 0) + 1;
            });
            
            chartSeverity.data.datasets[0].data = [
                severityCounts['CRITICAL'], severityCounts['WARNING'], severityCounts['INFO']
            ];
            chartSeverity.update('none');
            
            const sortedTypes = Object.entries(typeCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            chartTypes.data.labels = sortedTypes.map(item => item[0]);
            chartTypes.data.datasets[0].data = sortedTypes.map(item => item[1]);
            chartTypes.update('none');
        }

        // --- COMANDOS Y LOGICA DE MODAL ---

        async function triggerCommand(id, cmd) {
            let payload = { target_agent_id: id, command: cmd };
            
            if (cmd === 'CREATE_BASELINE') {
                const { value: pass } = await Swal.fire({
                    title:'Admin Password', input:'password', inputLabel:'Enter master password to authorize snapshot.', 
                    background:'#1e293b', color:'#fff', confirmButtonColor:'#3b82f6'
                });
                if (!pass) return;
                payload.command = { cmd: "CREATE_BASELINE", auth: pass };
            }
            
            try {
                 await fetch(`${API_BASE}/admin/command`, { 
                    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) 
                 });
                 Swal.fire({icon:'success', title:'Order Sent', toast:true, position:'top-end', showConfirmButton:false, timer:2000, background:'#1e293b', color:'#fff'});
            } catch(e) {
                 Swal.fire({icon:'error', title:'Error Sending Command', text:'C2 connection failed.', background:'#1e293b', color:'#fff'});
            }
        }
        
        async function logout() {
            await fetch('/api/v1/auth/logout', {method: 'POST'});
            window.location.href = '/login';
        }
        
        function openReports() {
             Swal.fire({
                title: 'Generate Report',
                text: 'This function will compile all audit data into a PDF.',
                icon: 'info',
                background: '#1e293b', color: '#fff'
             });
        }
        
        function refreshCurrentView() {
            if (currentReportType !== 'shell') {
                loadReportView(currentReportType);
            } else {
                 Swal.fire({
                    icon:'info', title:'Shell', text:'La pestaña Live Shell no tiene datos recargables.', 
                    toast:true, position:'top-end', showConfirmButton:false, timer:2000, background:'#1e293b', color:'#fff'
                });
            }
        }

        function openReport(id, hostname) {
            selectedAgentID = id;
            document.getElementById('agent-host-name').innerText = hostname;
            
            modalInstance.show();

            // Resetear las clases 'active' y 'show' en caso de que Bootstrap falle al cambiar el modal
            document.querySelectorAll('#reportTabs button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content .tab-pane').forEach(pane => pane.classList.remove('active', 'show'));
            
            // Default a Procesos
            document.querySelector('#reportTabs button[data-bs-target="#processes-tab-pane"]').classList.add('active');
            document.getElementById('processes-tab-pane').classList.add('active', 'show');

            loadReportView('processes');
        }

        async function loadReportView(type) {
            currentReportType = type;
            
            if (type === 'shell') return;
            
            const typeKey = type === 'processes' ? 'processes' : 'ports';
            const loader = document.getElementById(`${typeKey}-loader`);
            const contentArea = document.getElementById(`${typeKey}-content`);
            
            loader.classList.remove('d-none');
            contentArea.innerHTML = "";

            const command = type === 'processes' ? 'REPORT_PROCESSES' : 'REPORT_PORTS';
            triggerCommand(selectedAgentID, command);
            
            setTimeout(async () => {
                 try {
                     const res = await fetch(`${API_BASE}/agent/${selectedAgentID}/${typeKey}`);
                     const data = await res.json();
                     
                     loader.classList.add('d-none');
                     
                     if (data.length === 0) {
                         contentArea.innerHTML = `<div class="p-4 text-center text-muted">Esperando datos del agente o informe vacío.</div>`;
                         return;
                     }
                     
                     if (type === 'processes') renderProcessTable(data);
                     else if (type === 'ports') renderPortTable(data);

                 } catch(e){
                     loader.classList.add('d-none');
                     contentArea.innerHTML = `<div class="p-4 text-center text-danger">Error cargando el informe: ${e.message || 'Server Error'}.</div>`;
                 }
            }, 3500); 
        }

        function renderProcessTable(data) {
             let html = `<table class="table table-dark table-hover table-sm table-striped"><thead><tr><th>PID</th><th>Name</th><th>Risk</th><th>Path</th><th>Kill</th></tr></thead><tbody>`;
             data.forEach(p => {
                 let col = p.risk==='CRITICAL'?'text-danger fw-bold':(p.risk==='PRIVACY'?'text-info':'text-light');
                 html += `<tr><td>${p.pid}</td><td class="${col}">${p.name}</td><td>${p.risk}</td><td class="text-muted text-truncate" style="max-width:150px">${p.path}</td>
                 <td><button class="btn btn-sm btn-danger py-0" onclick="triggerCommand('${selectedAgentID}', 'KILL:${p.pid}')">X</button></td></tr>`;
             });
             document.getElementById('processes-content').innerHTML = html + "</tbody></table>";
        }

        function renderPortTable(data) {
            let html = `<table class="table table-dark table-hover table-sm table-striped"><thead><tr><th>Port</th><th>Proto</th><th>Service</th><th>Process</th></tr></thead><tbody>`;
             data.forEach(p => { 
                html += `<tr><td>${p.port}</td><td>${p.proto}</td><td class="text-info">${p.service}</td><td>${p.process || '?'}</td></tr>`; 
             });
            document.getElementById('ports-content').innerHTML = html + "</tbody></table>";
        }
    </script>
</body>
</html>